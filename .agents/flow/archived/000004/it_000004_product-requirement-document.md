# Requirement: LLM Skill for Strudel Pattern Generation

## Context

The current pattern generator (`src/lib/pattern-generator.ts`) uses static lookup tables to map user parameters (mood, tempo, style) to Strudel pattern strings. This produces repetitive, limited output. When an LLM is used to generate patterns instead, its responses are inconsistent and often produce invalid Strudel syntax that fails in the REPL.

This iteration creates a structured Claude Code skill (`SKILL.md`) that acts as a prompt guide for the LLM, teaching it Strudel mini-notation syntax, valid combinators, and how to map lofi parameters to working patterns. The skill lives under `backend/llm-skills/` — a new directory separate from the existing `.agents/skills/`.

## Goals

- Provide the LLM with a well-defined, structured prompt (SKILL.md) that produces valid Strudel pattern strings every time.
- Establish `backend/llm-skills/` as the dedicated directory for LLM-consumed skill files.
- Enable richer, more varied lofi patterns than the current static lookup approach.

## User Stories

### US-001: Create the Strudel pattern generator skill file

**As an** LLM invoked to generate a lofi pattern, **I want** a structured skill document that specifies valid Strudel syntax, parameter mappings, and expected output format **so that** I produce a valid Strudel pattern string that plays without errors in the REPL.

**Acceptance Criteria:**
- [ ] File exists at `backend/llm-skills/strudel-pattern-generator/SKILL.md`
- [ ] File follows the Anthropic Claude Code skill standard: YAML frontmatter (between `---` markers) + markdown body
- [ ] Frontmatter includes `name: strudel-pattern-generator` and a descriptive `description` field
- [ ] Frontmatter includes `disable-model-invocation: true` (skill is consumed programmatically, not auto-triggered)
- [ ] Markdown body documents valid Strudel mini-notation syntax: sound names (`bd`, `sd`, `hh`, `cp`), rhythm notation (`~`, `*N`, `[]`), and chaining methods (`.stack()`, `.slow()`, `.gain()`, `.cpm()`)
- [ ] Markdown body defines explicit parameter mappings:
  - `mood` (`chill` | `melancholic` | `upbeat`) → drum/harmonic pattern variations
  - `style` (`jazz` | `hip-hop` | `ambient`) → texture/instrumentation variations
  - `tempo` (60–120 BPM) → `.cpm(N)` value
- [ ] Markdown body includes at least one complete, valid example pattern per style (`jazz`, `hip-hop`, `ambient`)
- [ ] Markdown body specifies the exact output format the LLM must return: a single-line Strudel pattern string compatible with the REPL (no explanation, no code block, just the pattern string)
- [ ] Typecheck / lint passes (SKILL.md is not a TypeScript file; verify YAML frontmatter is valid YAML)

### US-002: Validate skill output against the Strudel REPL

**As the** lofi-maker app, **I want** to confirm that a pattern string generated by an LLM following the skill guide plays in the Strudel REPL without errors **so that** the skill is proven effective before integration into app code.

**Acceptance Criteria:**
- [ ] At least 3 manually crafted test pattern strings (one per style) following the skill's output format are documented in `backend/llm-skills/strudel-pattern-generator/examples/valid-patterns.md`
- [ ] Each example pattern is a valid `stack([...]).slow(N).gain(N).cpm(N)` expression
- [ ] Each example is visually verified to play in the browser REPL without throwing a console error

## Functional Requirements

- **FR-1:** Create directory `backend/llm-skills/strudel-pattern-generator/` with `SKILL.md` as the entrypoint.
- **FR-2:** `SKILL.md` YAML frontmatter must contain at minimum: `name`, `description`, `disable-model-invocation: true`.
- **FR-3:** `SKILL.md` body must document Strudel mini-notation syntax sufficient to construct `stack([s("..."), s("...")])` patterns with timing and gain controls.
- **FR-4:** `SKILL.md` body must contain a parameter-to-pattern mapping section covering all current `Mood` and `Style` values defined in `src/lib/pattern-generator.ts`.
- **FR-5:** `SKILL.md` body must specify the LLM output contract: return only a single-line valid Strudel pattern string, no prose, no markdown code fences.
- **FR-6:** `SKILL.md` body must include a section with at least 3 complete, copy-pasteable example outputs (one per style).
- **FR-7:** Create `backend/llm-skills/strudel-pattern-generator/examples/valid-patterns.md` containing the example patterns from FR-6, used for manual REPL verification.

## Non-Goals (Out of Scope)

- Modifying `src/lib/pattern-generator.ts` or any existing app source code.
- Implementing LLM API integration or wiring the skill into the app's runtime.
- Adding a backend server, API endpoint, or build step.
- Automated testing of LLM output (manual REPL verification is sufficient for this iteration).
- Supporting parameters beyond the current `Mood`, `Style`, and `tempo` fields.

## Open Questions

- Should `backend/llm-skills/` eventually become part of the project build (e.g., bundled as a prompt asset), or remain a developer-only reference? To be decided in a future iteration.
- Which LLM model will consume this skill in production? This may affect how prescriptive the output format instructions need to be.
